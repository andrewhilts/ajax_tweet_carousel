<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN"
           "http://www.w3.org/TR/html4/strict.dtd">
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
<head>
<title>Ajax Tweet Carousel</title>
<link rel="stylesheet" href="app/css/main.css" type="text/css" media="screen" />
<script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jquery/1.4.2/jquery.min.js"></script>
<!-- <script type="text/javascript" src="app/js/jquery.jcarousel.min.js"></script> -->
<script type="text/javascript" src="app/js/relative_time.js"></script>
<script type="text/javascript" src="app/js/jquery.jcarousel.js"></script>
<script type="text/javascript" src="app/js/tweet-retriever.js"></script>
</head>

<body>
  <div id="content">
      <h1>Ajax Tweet Carousel</h1>
      <aside><a href="https://github.com/andrewhilts/ajax_tweet_carousel" title="Fork me on Github!"><img src="https://github.com/images/modules/dashboard/bootcamp/octocat_fork.png" alt="Fork me on Github!">Fork me on Github</a></aside>
      <p>The default user is &ldquo;Internet Radio&rdquo;, the most prolific Twitter account (so the dynamic refreshing of the list is made apparent). By default, the system queries Twitter's API every 2 minutes for the latest 5 tweets (We can't query more than 100 times an hour). 
      <p>This system will check to see which of the currently displayed tweets are different from the latest ones, and replace those that are no longer in the latest 5 with the new tweets. 
        <div id="added_tweets"></div>
        <h2>Latest Tweets from <em>InternetRadio</em></h2>
		  <div id="ticker_wrapper" class="hoz">
		    <ul id="tweets"></ul>
		  </div>
		  <p>**This is the horizontal version. Check out the <a href="vertical.html">vertical</a> (buggy) version.</a>
	</div>
</body>
<script type="text/javascript">
var popsicle = "nope";
var done = "start";
var orig_size = "";
var index = "";
var added_tweets = 0;

window.onload = function () {
	//fade to 0.01 opacity so as to not break box model
		function callback1(jcarousel_object, li_object, index, state){
		  	$(li_object).fadeTo(500,0.01);
		}
		function callback2(jcarousel_object, li_object, index, state){
		    //initial last visible item doesn't do the fade IN animation
		    if(state!=="init"){
		    	$(li_object).fadeTo(1,0.01).delay(500).fadeTo(500,1);
		    }
		}
		function mycarousel_initCallback(carousel){
		            // Pause autoscrolling if the user moves with the cursor over the clip.
		      carousel.clip.hover(function() {
		          carousel.stopAuto();
		      }, function() {
		          carousel.startAuto();
		      });
		  };
		  //var carousel = jQuery('#twittlist0').data('jcarousel');
		  function itemLoadCallbackFunction(carousel, state) { 
		    size = carousel.size();
		    if (state == 'init') { 
		      orig_size = carousel.size();
		      index = orig_size;
		    }
		    else if (popsicle=="yay"){
		      carousel.add(index, '<img src="" width="290" height="50">');
		      index-=1;
		      if(index==0){index=orig_size;} 
		      popsicle="nope";
		      alert(index);
		    }
		    else {
		       real_times = $('#ticker_wrapper').find('span.real_time');
		       for(i in real_times){
		         if(!isNaN(i)){
		           new_time = real_times[i].innerHTML;
		           old_time = $(real_times[i]).parent().children('span.date');
		           $(old_time[0]).html(timeAgo(new_time));
		         }
		       }
		       if((add_tweet=="")||(!add_tweet)||(add_tweet.length==0)){}
						else{
						//alert(add_tweet.length);

						 //add every new tweet
		         for (i in add_tweet){
		           if(isNaN(i)){}
		           else{
		             //alert(i);
		             var new_item = '<a href="http://www.twitter.com/'+add_tweet[i][2]+'" title="'+add_tweet[i][2]+'&rsquo;s Twitter page"><img src="'+add_tweet[i][3]+'" alt="'+add_tweet[i][2]+'&rsquo;s profile picture"/></a><span class="name"><a href="http://www.twitter.com/'+add_tweet[i][2]+'" title="'+add_tweet[i][2]+'&rsquo;s Twitter page">'+add_tweet[i][2]+'</a></span><span class="date">'+add_tweet[i][1]+'</span><p>'+add_tweet[i][0]+'</p><span class="real_time">'+add_tweet[i][4]+'</span>';
		             //alert("adding at index #"+index);
		             carousel.add(index, new_item);
		             added_tweets+=1;
		             $('#added_tweets').html("Tweets added since page load:  <b>"+added_tweets+"</b>");
		             //update index so next tweet replaces the oldest entry 
		             index-=1;
		             //return index to number of tweets in carousel, start index cycle again
		             if(index==0){index=orig_size;}
		            }
		          }
		          add_tweet="";

		       }
		    }
		  }
		
	jQuery('#tweets').jcarousel({
    	auto: 5,
	    animation:1000,
	    wrap: 'circular',
	    scroll:1,
	    //vertical:true,
	    itemFallbackDimension:300,
	    itemFirstOutCallback: {
	      onBeforeAnimation: callback1
	    },
	    itemLastInCallback: {
	      onBeforeAnimation: callback2
	    },
	    itemLoadCallback: itemLoadCallbackFunction,
	    initCallback: mycarousel_initCallback
  	});
  
};
</script>

</html>